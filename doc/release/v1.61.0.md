[Full Changelog](https://github.com/c9s/bbgo/compare/v1.60.3...main)

## Fixes

 - [#1751](https://github.com/c9s/bbgo/pull/1751): FIX: fix OnNew event must be called before OnFilled
 - [#1761](https://github.com/c9s/bbgo/pull/1761): FIX: [bybit] fix redundant code
 - [#1781](https://github.com/c9s/bbgo/pull/1781): FIX: [xmaker] fix covered position field
 - [#1787](https://github.com/c9s/bbgo/pull/1787): FIX: fix order update comparison method
 - [#1788](https://github.com/c9s/bbgo/pull/1788): FIX: [core] remove session order store
 - [#1789](https://github.com/c9s/bbgo/pull/1789): FIX: add slackAttachment method on Deposit
 - [#1790](https://github.com/c9s/bbgo/pull/1790): FIX: [xmaker] check connectivity before calling updateQuote
 - [#1797](https://github.com/c9s/bbgo/pull/1797): FIX: [liqmaker] fix stopEMA subscription
 - [#1802](https://github.com/c9s/bbgo/pull/1802): FIX: [xmaker] truncate balances before submitting orders
 - [#1803](https://github.com/c9s/bbgo/pull/1803): FIX: [deposit2transfer] check transfer amount before transferring 
 - [#1809](https://github.com/c9s/bbgo/pull/1809): FIX: [xalign] verify LargetAmountAlert is not nil
 - [#1811](https://github.com/c9s/bbgo/pull/1811): FIX: [deposit2transfer] fix last deposit time checking
 - [#1816](https://github.com/c9s/bbgo/pull/1816): FIX: [circuit breaker] separate metrics label by symbol and add panic handler
 - [#1817](https://github.com/c9s/bbgo/pull/1817): FIX: refactor and redesign connectivity
 - [#1818](https://github.com/c9s/bbgo/pull/1818): FIX: fix deposit time checking
 - [#1819](https://github.com/c9s/bbgo/pull/1819): FIX: [max] use the same depth to QueryDepth
 - [#1827](https://github.com/c9s/bbgo/pull/1827): FIX: do not reset snapshot and once in tryFetch
 - [#1828](https://github.com/c9s/bbgo/pull/1828): FIX: [depth] fix early snapshot id checking
 - [#1829](https://github.com/c9s/bbgo/pull/1829): FIX: depth buffer can skip old event if event.FinalUpdateID
 - [#1830](https://github.com/c9s/bbgo/pull/1830): FIX: [xdepthmaker] fix book pricing
 - [#1837](https://github.com/c9s/bbgo/pull/1837): FIX: upgrade go-chart from 2.1.0 to 2.1.2 to avoid CVE
 - [#1842](https://github.com/c9s/bbgo/pull/1842): FIX: assign CircuitBreakLossThreshold to MaximumTotalLoss and delete circuitBreakEMA
 - [#1849](https://github.com/c9s/bbgo/pull/1849): FIX: [xalign] add markets to price resolver
 - [#1850](https://github.com/c9s/bbgo/pull/1850): FIX: [depth] fix depth buffer and tests
 - [#1853](https://github.com/c9s/bbgo/pull/1853): FIX: If futures order is Market order use avg price replace zero price
 - [#1854](https://github.com/c9s/bbgo/pull/1854): FIX: [dca2] update message log level
 - [#1865](https://github.com/c9s/bbgo/pull/1865): FIX: fix AverageDepthPrice and add test TestPriceVolumeSlice\_AverageDepthPrice
 - [#1869](https://github.com/c9s/bbgo/pull/1869): FIX: [okex] add TestExchange\_SubmitOrder for okx
 - [#1873](https://github.com/c9s/bbgo/pull/1873): FIX: [max] fix query depth wrong symbol convertor

## Features and Improvements

 - [#1872](https://github.com/c9s/bbgo/pull/1872): FEATURE: [dynamic] dynamic nested metric from struct 
 - [#1871](https://github.com/c9s/bbgo/pull/1871): FEATURE: support dynamic metrics for config fields
 - [#1866](https://github.com/c9s/bbgo/pull/1866): FEATURE: [xnav] support breakdown and improve price solving logics
 - [#1864](https://github.com/c9s/bbgo/pull/1864): FEATURE: [core] integrate priceSolver into the session struct
 - [#1860](https://github.com/c9s/bbgo/pull/1860): FEATURE: [max] handle and merge debt principle and interests in Stream
 - [#1859](https://github.com/c9s/bbgo/pull/1859): FEATURE: add account margin level metrics
 - [#1857](https://github.com/c9s/bbgo/pull/1857): FEATURE: [max] unlock depth buffer after emit
 - [#1858](https://github.com/c9s/bbgo/pull/1858): FEATURE: [dca2] set order executor max retries from 50 to 5
 - [#1856](https://github.com/c9s/bbgo/pull/1856): IMPROVE: [xmaker] improve quota calculation
 - [#1870](https://github.com/c9s/bbgo/pull/1870): DEBUG: [max] add log to debug depth buffer
 - [#1852](https://github.com/c9s/bbgo/pull/1852): IMPROVE: [xmaker] implement allowMarginHedge and its tests
 - [#1851](https://github.com/c9s/bbgo/pull/1851): IMPROVE: [autoborrow] improve margin level alert details
 - [#1847](https://github.com/c9s/bbgo/pull/1847): REFACTOR: [xalign] refactor detector
 - [#1848](https://github.com/c9s/bbgo/pull/1848): DOC: fix update strategy.go reference
 - [#1846](https://github.com/c9s/bbgo/pull/1846): IMPROVE: [xmaker] use quote, base as much as possible
 - [#1845](https://github.com/c9s/bbgo/pull/1845): IMPROVE: [d2t] check and adjust repay amount, display hostname
 - [#1840](https://github.com/c9s/bbgo/pull/1840): feature: add binance TRADE_LITE event
 - [#1843](https://github.com/c9s/bbgo/pull/1843): REFACTOR: [max] generate privatechannel map with mapgen
 - [#1844](https://github.com/c9s/bbgo/pull/1844): FEATURE: [deposit2transfer] support autoRepay
 - [#1841](https://github.com/c9s/bbgo/pull/1841): FEATURE: [max] define channels
 - [#1839](https://github.com/c9s/bbgo/pull/1839): FEATURE: [max] subscription filters not empty
 - [#1836](https://github.com/c9s/bbgo/pull/1836): IMPROVE: [xmaker] add more improvements
 - [#1835](https://github.com/c9s/bbgo/pull/1835): FEATURE: [max] new method for depth buffer to set snapshot
 - [#1834](https://github.com/c9s/bbgo/pull/1834): REFACTOR: integrate connectivity into session 
 - [#1832](https://github.com/c9s/bbgo/pull/1832): dep: bump morphy2k/revive-action from 2.7.0 to 2.7.1
 - [#1833](https://github.com/c9s/bbgo/pull/1833): dep: bump codecov/codecov-action from 4 to 5
 - [#1831](https://github.com/c9s/bbgo/pull/1831): REFACTOR: share stream book metrics labels
 - [#1826](https://github.com/c9s/bbgo/pull/1826): FEATURE: [xmaker] allocate isolated market data stream
 - [#1825](https://github.com/c9s/bbgo/pull/1825): IMPROVE: [metrics] make the metrics name consistent and update best ask/bid prices
 - [#1824](https://github.com/c9s/bbgo/pull/1824): FEATURE: [xdepthmaker] add maker metrics
 - [#1823](https://github.com/c9s/bbgo/pull/1823): IMPROVE: [xgap] customize source symbol
 - [#1822](https://github.com/c9s/bbgo/pull/1822): IMPROVE: [tradingutil] improve UniversalCancelAllOrders by querying open orders
 - [#1821](https://github.com/c9s/bbgo/pull/1821): FEAUTRE: [max] update buffer second
 - [#1820](https://github.com/c9s/bbgo/pull/1820): FEATURE: add new migration script to record the net profit values
 - [#1815](https://github.com/c9s/bbgo/pull/1815): IMPROVE: [deposit2transfer] ignore dust amount
 - [#1814](https://github.com/c9s/bbgo/pull/1814): IMPROVE: [maxapi] update deposit info fields
 - [#1813](https://github.com/c9s/bbgo/pull/1813): FEATURE: [binance] add update when first receive the orderbook event
 - [#1812](https://github.com/c9s/bbgo/pull/1812): FEAUTRE: [max] reset book if receive both empty asks and bids
 - [#1806](https://github.com/c9s/bbgo/pull/1806): dep: bump morphy2k/revive-action from 2.6.0 to 2.7.0
 - [#1808](https://github.com/c9s/bbgo/pull/1808): IMPROVE: [deposit2transfer] add livenote support
 - [#1791](https://github.com/c9s/bbgo/pull/1791): FEATURE: [xalign] add notification when order quote is over alert amount
 - [#1807](https://github.com/c9s/bbgo/pull/1807): FEATURE: [livenote] object comparison, comments and mentions
 - [#1805](https://github.com/c9s/bbgo/pull/1805): FEATURE: [dynamic] support dynamic compare
 - [#1804](https://github.com/c9s/bbgo/pull/1804): FEATURE: add livenote support
 - [#1801](https://github.com/c9s/bbgo/pull/1801): IMPROVE: [xalign] improve logs
 - [#1799](https://github.com/c9s/bbgo/pull/1799): FEATURE: [liqmaker] add more metrics
 - [#1798](https://github.com/c9s/bbgo/pull/1798): FEATURE:update binance positionRisk api to v3
 - [#1743](https://github.com/c9s/bbgo/pull/1743): add new tag ignore to prevent printing specific field
 - [#1796](https://github.com/c9s/bbgo/pull/1796): IMPROVE: [liqmaker] improve interval checking and tickers
 - [#1795](https://github.com/c9s/bbgo/pull/1795): IMPROVE: add test helper for price side quantity assertion
 - [#1792](https://github.com/c9s/bbgo/pull/1792): FEATURE: [liqmaker] add stop functions
 - [#1763](https://github.com/c9s/bbgo/pull/1763): CHORE: solved all deprecated, comment all unused variables and functions
 - [#1784](https://github.com/c9s/bbgo/pull/1784): FEATURE: no use MAX(quantity, minQuantity) to avoid sufficient quantity
 - [#1786](https://github.com/c9s/bbgo/pull/1786): FEATURE: [xalign] detect active depoit. if found, skip align
 - [#1785](https://github.com/c9s/bbgo/pull/1785): FEATURE: [okx] support broker id
 - [#1782](https://github.com/c9s/bbgo/pull/1782): IMPROVE: [grid2][xmaker] prune expired trades
 - [#1779](https://github.com/c9s/bbgo/pull/1779): FEATURE: [bybit] upgrade classic account to UTA
 - [#1765](https://github.com/c9s/bbgo/pull/1765): FEATURE: [max] use QueryDepth to build orderbook
 - [#1771](https://github.com/c9s/bbgo/pull/1771): dep: bump morphy2k/revive-action from 2.5.10 to 2.6.0
 - [#1780](https://github.com/c9s/bbgo/pull/1780): FEATURE: [xmaker] support delayed hedge
 - [#1778](https://github.com/c9s/bbgo/pull/1778): FEATURE: [bybit] use execution.fast topic
 - [#1777](https://github.com/c9s/bbgo/pull/1777): pkg/exchange: update query open orders to latest
 - [#1776](https://github.com/c9s/bbgo/pull/1776): pkg/exchange: update query wallet balance to latest
 - [#1775](https://github.com/c9s/bbgo/pull/1775): FEATURE: [bybit] update query closed order to latest
 - [#1774](https://github.com/c9s/bbgo/pull/1774): FEATURE: [bybit] move rate limiter of cancel to api level
 - [#1773](https://github.com/c9s/bbgo/pull/1773): FEATURE: [bybit] add marketunit for submit order
 - [#1772](https://github.com/c9s/bbgo/pull/1772): FEATURE: [bybit] use fee currency of trade
 - [#1770](https://github.com/c9s/bbgo/pull/1770): IMPROVE: [xmaker] add more stability improvements and refactoring
 - [#1769](https://github.com/c9s/bbgo/pull/1769): FEATURE: [autobuy] check quote balance before submitting order
 - [#1768](https://github.com/c9s/bbgo/pull/1768): IMPROVE: [xmaker] add more improvements
 - [#1767](https://github.com/c9s/bbgo/pull/1767): IMPROVE: use float64 in pricesolver internally to make it more precise
 - [#1766](https://github.com/c9s/bbgo/pull/1766): REFACTOR: refactor account value calculator with price solver 
 - [#1749](https://github.com/c9s/bbgo/pull/1749): Use new circuitbreaker in common strategy
 - [#1760](https://github.com/c9s/bbgo/pull/1760): FEATURE: [max] add QueryDepth v3 API to query orderbook
 - [#1762](https://github.com/c9s/bbgo/pull/1762): MINOR: [bybit] use individual rate limit on wallet-balance API
 - [#1759](https://github.com/c9s/bbgo/pull/1759): FEATURE: [bybit] integrate the v5 trade history
 - [#1757](https://github.com/c9s/bbgo/pull/1757): FEATURE: [bybit] add v5 execution request
 - [#1758](https://github.com/c9s/bbgo/pull/1758): FEATURE: [xmaker] add depth ratio signal
 - [#1755](https://github.com/c9s/bbgo/pull/1755): IMPROVE: [xdepthmaker] improve price solver integration and hedge method 
 - [#1754](https://github.com/c9s/bbgo/pull/1754): REFACTOR: [xdepthmaker] refactor x depth maker 
 - [#1753](https://github.com/c9s/bbgo/pull/1753): IMPROVE: [xdepthmaker] use order query to update the canceled order, fix depth price, fix symbol column lengths, fix covered position
 - [#1746](https://github.com/c9s/bbgo/pull/1746): DOC: add the explanation on how to read/write strategy fields
 - [#1752](https://github.com/c9s/bbgo/pull/1752): IMPROVE: [biget] several improvements
 - [#1748](https://github.com/c9s/bbgo/pull/1748): IMPROVE: [db] add index on positions table
